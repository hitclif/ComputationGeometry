using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using PolygonIntersection;

namespace Tests
{
    [TestClass]
    public class PolygonIntersectionTests
    {
        [TestMethod]
        public void TestCase1()
        {
            Execute(
                "1 11 -8 -3 -9 -13",
                "5 14 -1 0 4 -14 8 -8 12 4",
                "");
        }

        [TestMethod]
        public void TestCase2()
        {
            Execute(
                "-8 0 -1 -5 5 1 0 6 -6 5",
                "-6 4 -3 -3 6 -3 8 6",
                "-3 -3 1 -3 5 1 1 5 -6 4");
        }

        [TestMethod]
        public void TestCase3()
        {

            Execute(
                "0 0 10 0 10 10 0 10",
                "5 -1 11 5 5 11 -1 5",
                "6 0 10 4 10 6 6 10 4 10 0 6 0 4 4 0");
        }

        [TestMethod]
        public void TestCase5()
        {
            Execute(
                "3 14 -6 6 -12 -4 -7 -13 6 -7",
                "-1 7 -7 -13 11 -7",
                "-7 -13 6 -7 5 0 -1 7");
        }

        [TestMethod]
        public void TestCase6()
        {
            Execute(
                "8 11 1 5 -4 -5 4 -13 13 -15",
                "8 11 -1 7 -10 -2 -7 -6 1 -10 6 -1",
                "1 5 -4 -5 1 -10 6 -1 8 11");
        }

        [TestMethod]
        public void TestCase9()
        {
            Execute(
                "4 9 -14 6 -12 -10 0 -14 4 -2 6 5",
                "-11 6 -10 -10 -9 -11 2 -8 -2 -3",
                "-10 -10 -9 -11 2 -8 -2 -3 -11 6");
        }

        [TestMethod]
        public void TestCase11()
        {
            Execute(
                "162 251 92 242 58 237 14 224 -9 216 -63 194 -139 128 -225 52 -256 -12 -279 -149 -262 -220 -101 -229 40 -181 92 -160 194 29 179 192 174 222",
                "-59 258 -123 235 -179 182 -214 148 -232 113 -250 69 -283 -87 -286 -130 -285 -158 -273 -224 -264 -239 -243 -263 -233 -273 -193 -284 -142 -292 -38 -277 82 -259 88 -258 134 -250 171 -237 200 -226 212 -219 233 -204 239 -198 257 -179 277 -110 283 -86 285 -73 288 12 287 28 282 48 242 175 236 182 218 198 179 220 174 222 161 226 106 239 50 251 45 252 2 257",
                "161 226 106 239 92 242 58 237 14 224 -9 216 -63 194 -139 128 -225 52 -256 -12 -279 -149 -262 -220 -101 -229 40 -181 92 -160 194 29 179 192 174 222");
        }

        [TestMethod]
        public void TestCase16()
        {
            Execute(
                "7 298 -31 296 -60 294 -89 291 -129 286 -134 284 -141 281 -153 273 -174 247 -199 211 -207 197 -224 166 -245 117 -253 96 -272 10 -274 -22 -273 -40 -268 -94 -265 -117 -258 -142 -249 -173 -245 -179 -221 -213 -212 -224 -204 -232 -190 -245 -183 -249 -118 -265 -92 -271 16 -279 43 -275 76 -270 149 -253 163 -249 206 -224 211 -221 219 -211 260 -145 280 -108 287 -93 290 -81 294 -41 296 -11 297 9 286 115 283 135 278 161 271 181 255 215 241 238 223 253 196 270 176 279 162 284 147 288 106 292 78 294 46 296",
                "48 288 30 287 8 285 -63 275 -106 265 -111 262 -179 220 -218 194 -225 188 -238 176 -272 142 -286 115 -292 98 -296 84 -298 58 -300 -8 -299 -78 -291 -133 -255 -235 -245 -251 -238 -256 -230 -261 -133 -273 -102 -274 -38 -275 38 -269 77 -256 100 -247 126 -233 163 -206 180 -191 206 -160 221 -142 242 -111 253 -84 262 -46 265 -19 270 27 273 68 269 94 262 133 255 167 246 205 229 240 219 254 213 259 189 266 146 274 140 275 108 280",
                "30 287 8 285 -63 275 -106 265 -111 262 -179 220 -203 204 -207 197 -224 166 -245 117 -253 96 -272 10 -274 -22 -273 -40 -268 -94 -265 -117 -258 -142 -249 -173 -245 -179 -221 -213 -212 -224 -204 -232 -190 -245 -183 -249 -118 -265 -92 -271 -38 -275 38 -269 77 -256 100 -247 126 -233 163 -206 180 -191 206 -160 221 -142 242 -111 253 -84 262 -46 265 -19 270 27 273 68 269 94 262 133 255 167 246 205 229 240 219 254 213 259 189 266 146 274 140 275 108 280 48 288");
        }

        [TestMethod]
        public void TestCase24()
        {
            Execute(
                "33 190 -84 172 -173 110 -192 50 -196 -33 -182 -143 -146 -199 -42 -195 22 -182 88 -168 93 -165 160 -63 185 -6 175 26 167 50 156 82 127 134 119 147 91 165 75 172",
                "99 180 23 176 -45 169 -90 159 -108 148 -133 128 -156 108 -166 42 -152 -70 -150 -79 -145 -87 10 -144 50 -143 77 -124 115 -89 125 -71 151 -20 164 32 179 122 141 167 128 173",
                "-45 169 -90 159 -108 148 -133 128 -156 108 -166 42 -152 -70 -150 -79 -145 -87 10 -144 50 -143 77 -124 115 -89 125 -71 151 -20 164 32 167 50 156 82 127 134 119 147 91 165 75 172 61 178 23 176");
        }

        [TestMethod]
        public void TestCase24Modified()
        {
            Execute(
                "33 190 -84 172 160 -63 185 -6 175 26 167 50 156 82 127 134 119 147 91 165 75 172",
                "99 180 23 176 -45 169 151 -20 164 32 179 122 141 167 128 173",
                "-45 169 151 -20 164 32 167 50 156 82 127 134 119 147 91 165 75 172 61 178 23 176");
        }

        [TestMethod]
        public void TestCase35()
        {
            Execute(
                "-399 -2 -416 -3 -475 -8 -503 -11 -510 -12 -532 -16 -548 -19 -614 -32 -630 -36 -657 -46 -689 -58 -752 -83 -776 -96 -820 -130 -858 -164 -899 -203 -913 -224 -934 -256 -937 -261 -949 -282 -960 -306 -970 -329 -975 -341 -984 -386 -994 -443 -996 -458 -998 -474 -999 -513 -998 -563 -997 -577 -995 -599 -994 -607 -989 -642 -985 -662 -970 -693 -925 -768 -903 -804 -894 -818 -882 -833 -864 -850 -854 -859 -841 -869 -816 -886 -808 -891 -793 -900 -760 -916 -735 -926 -698 -939 -670 -947 -582 -970 -578 -971 -555 -976 -527 -982 -509 -984 -429 -992 -393 -995 -366 -996 -355 -994 -335 -990 -303 -983 -279 -975 -268 -971 -223 -954 -211 -949 -196 -942 -177 -933 -152 -920 -132 -895 -114 -872 -90 -840 -77 -822 -71 -813 -67 -801 -52 -754 -43 -723 -35 -682 -33 -671 -30 -642 -24 -581 -21 -541 -22 -508 -29 -438 -43 -318 -52 -271 -62 -241 -77 -199 -80 -191 -101 -145 -109 -128 -115 -118 -131 -103 -149 -87 -177 -68 -215 -48 -246 -34 -256 -30 -259 -29 -285 -22 -343 -11 -367 -7",
                "421 982 385 977 328 968 323 967 304 962 297 960 266 950 249 943 221 929 203 918 145 880 129 869 104 851 101 848 91 837 82 825 77 818 60 791 44 760 35 736 24 702 13 652 8 629 6 617 1 580 0 562 4 418 5 397 7 357 8 340 10 325 13 312 24 271 32 242 49 190 54 176 94 103 104 86 128 54 138 41 143 38 165 29 199 22 246 13 267 11 290 9 310 8 412 3 438 2 470 1 495 2 525 4 550 6 593 10 645 15 671 20 680 22 723 34 750 42 763 47 780 56 818 77 823 80 861 109 869 116 872 119 888 136 900 152 916 176 933 207 940 224 945 242 955 285 959 307 960 313 977 445 981 477 988 540 989 553 988 596 986 623 985 632 965 675 963 679 927 747 900 793 884 818 867 844 857 856 843 872 831 883 796 912 766 925 738 937 723 943 697 949 610 967 563 974 551 975 518 977",
                "");
        }

        private static void Execute(string polygon1, string polygon2, string intersectionCoordinates)
        {
            var p1 = Tools.PolygonSegmentsFromStringCoordinates(polygon1).ToArray();
            var p2 = Tools.PolygonSegmentsFromStringCoordinates(polygon2).ToArray();
            var expected = Tools.PolygonSegmentsFromStringCoordinates(intersectionCoordinates)
                .ToList();

            var svg = new[] { p1, p2 }.ToSvg(expected);

            var intersectionPoints = new PolygonIntersectionFinder()
                .FindIntersection(p1, p2)
                .ToList();

            var ip = string.Join(" ", intersectionPoints.Select(p => p.ToString()).ToArray());

            Console.WriteLine("Expected: {0}", intersectionCoordinates);
            Console.WriteLine("Found: {0}", ip);

            Assert.AreEqual(expected.Count, intersectionPoints.Count);

            if(intersectionPoints.Count == 0 || expected.Count == 0)
            {
                return;
            }

            var index = intersectionPoints.IndexOf(expected[0]);
            var rotated = intersectionPoints
                .Skip(index)
                .Take(intersectionPoints.Count - index)
                .Union(intersectionPoints.Take(index))
                .ToArray();

            for(var i = 0; i < expected.Count; i++)
            {
                Assert.AreEqual(expected[i], rotated[i]);
            }
        }
    }
}
